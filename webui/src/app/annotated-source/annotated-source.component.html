<div class="layout-page col-lg-9 col-md-9 col-sm-8 col-xs-8 no-pad">
    <!-- Annotated source -->
    <div class="annotated-source-body col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
        <nav class="file-header col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
            <span>{{ source.project }}</span>
            <span  class="path-divider">/</span>
            <strong>{{ source.filename }}</strong>
        </nav>
        <main #scrollView class="scrollable-content col-lg-12 col-md-12 col-sm-12 col-xs-12" [ngClass]="showMessageList ? 'expanded' : 'reduce'">
            <div class="missing-file-content" *ngIf="!source.lines">
                <h4>Missing file content</h4>
                <p>
                    This is most likely due to an error during the HTML report
                    generation.
                </p>
            </div>
            <div class="file" *ngIf="source.lines">
                <annotated-source-content
                                          [lines]="source.lines"
                                          [tools]="source.tools"
                                          [coverage]="source.coverage"
                                          [inlineMessages]="inlineMessages"
                                          [inlineAnnotations]="inlineAnnotations"
                                          [displayMessages]="displayMessages">
                </annotated-source-content>
            </div>
        </main>
    </div>
    <!--    <footer class="layout-page-footer location-view col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" *ngIf="displayMessages && inlineMessagesShownCount">-->
    <footer class="layout-page-footer location-view col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" *ngIf="displayMessages">
        <div class="location-view-flex col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
            <div class="location-view-header col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                <span class="location-view-title" (click)="tabOpen = 'metric'" [ngClass]="tabOpen == 'metric' ? 'selected': ''">
                    File Metrics
                </span>
                <span class="location-view-title" (click)="tabOpen = 'message'; thisFile = true" [ngClass]="tabOpen == 'message' ? 'selected': ''">
                    File messages
                </span>
                <span class="location-view-title" (click)="tabOpen = 'messages'; thisFile = false" [ngClass]="tabOpen == 'messages' ? 'selected': ''">
                    All messages
                </span>

                <button (click)="writeReview()" class="location-view-review-btn" [disabled]="!checked_msg || checked_msg.length == 0">
                    <span>Add review</span>
                </button>
                <button class="location-view-collapse-btn"
                        [mdTooltip]="showMessageList ? 'Hide' : 'Show'"
                        mdTooltipPosition="left"
                        (click)="showMessageList = !showMessageList">
                    <md-icon class="md-18" [ngClass]="{ expanded: showMessageList }">
                        keyboard_capslock
                    </md-icon>
                </button>
            </div>
            <div class="location-view-list col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" [ngClass]="showMessageList ? 'expanded' : 'reduce'">
                <table *ngIf="tabOpen == 'metric'" class="file-line-container col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <span *ngIf="source.metrics.length > 0">
                        <tbody *ngFor="let metric of source.metrics; let idx = index" [attr.data-index]="idx" class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" [ngClass]="idx % 2 == 0 ? 'metric1' : 'metric2'">
                            <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 ">{{metric.rule.name}}</span>
                            <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 ">{{metric.value}}</span>
                        </tbody>
                    </span>
                    <span class="info-span col-lg-12 col-md-12 col-sm-12 col-xs-12" *ngIf="source.metrics.length == 0">
                        No metrics for this file.
                    </span>
                </table>


                <table *ngIf="tabOpen == 'message'" class="file-line-container col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                    <span class="all-sources-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">

                        <span *ngFor="let mySource of reportService.message.sources"
                              class=" col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                              [ngClass]="mySource.filename === source.filename ? '' : 'hideIt'">
                            <span id="{{mySource.filename}}" class="all-messages-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad open" *ngIf="(mySource._total_message_count > 0 || !mySource._total_message_count)" >
                                <span *ngFor="let message of mySource.messages"
                                      class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                                      [ngClass]="(this.reportService.hideFiles && (message._ui_total_message_count == 0 || ( message._ui_total_message_count == null && message._total_message_count == 0)) || message.hide == false) ? 'hideIt' : ''">
                                    <span class="message-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" [ngClass]="{ selected: selectedLine == message.line }">
                                        <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                            <span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad" [routerLink]="['.', { line: message.line }]">
                                                {{message.line}}:{{message.col_begin}}
                                            </span>
                                            <span class="col-lg-10 col-md-10 col-sm-10 col-xs-10 no-pad" [routerLink]="['.', { line: message.line }]">
                                                {{message.name}}
                                            </span>
                                            <span class="checkbox-span col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad">
                                                <input type="checkbox" (click)="checkMessage(message.tool_msg_id)">
                                            </span>
                                        </span>
                                    </span>

                                    <span  *ngIf="message.user_review" class="review-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                                        <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                            <!--<span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad"></span>-->
                                            <span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 no-pad">
                                                {{message.user_review.date | date : 'dd-MM-yyyy HH:mm'}}
                                            </span>
                                            <span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad">
                                                {{message.user_review.author}}
                                            </span>
                                            <span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 no-pad">
                                                {{message.user_review.status.toUpperCase()}}
                                            </span>
                                            <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-pad">
                                                {{message.user_review.message}}
                                            </span>

                                            <span [ngClass]="message.review_history.length == 0 ? 'inactive' : ''" class="history-span col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad"
                                                  (click)="ShowReviewHistory(message.review_history)">
                                                <md-icon>history</md-icon>
                                            </span>
                                        </span>
                                    </span>
                                </span>
                            </span>
                            <span class="info-span col-lg-12 col-md-12 col-sm-12 col-xs-12" *ngIf="mySource.filename === source.filename && mySource._ui_total_message_count === 0"> There are no message corresponding to the selected filters </span>
                        </span>
                    </span>
                </table>

                <table *ngIf="tabOpen == 'messages'" class="file-line-container col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                    <span class="all-sources-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                          *ngIf="reportService.message._ui_total_message_count > 0 || !reportService.message._ui_total_message_count">
                        <span *ngFor="let mySource of reportService.message.sources"
                              class=" col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                              [ngClass]="(this.reportService.hideFiles && (mySource._ui_total_message_count == 0 || ( mySource._ui_total_message_count == null && mySource._total_message_count == 0))) ? 'hideIt' : ''">
                            <span id="{{mySource.filename}}" class="source-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad open">
                                <span class="header-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" (click)="openClose(mySource.filename)">
                                    <span class="col-lg-9 col-md-9 col-sm-9 col-xs-9">
                                        <span *ngIf="!(mySource._ui_total_message_count == 0 || ( mySource._ui_total_message_count == null && mySource._total_message_count == 0))">
                                            <md-icon  class="md-18 source-tree">chevron_right</md-icon>
                                        </span>
                                        <span class="project-name"> {{mySource.projectName}} </span>
                                        <span class="file-name">{{mySource.filename}}</span>
                                    </span>
                                    <span class="center col-lg-3 col-md-3 col-sm-3 col-xs-3">
                                        {{
                                        mySource._ui_total_message_count != null ?
                                        mySource._ui_total_message_count :
                                        mySource._total_message_count
                                        }}
                                    </span>
                                </span>

                                <span class="all-messages-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                                    <span *ngFor="let message of mySource.messages"
                                          class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                                          [ngClass]="(this.reportService.hideFiles && (message._ui_total_message_count == 0 || ( message._ui_total_message_count == null && message._total_message_count == 0)) || message.hide == false) ? 'hideIt' : ''">
                                        <span class="message-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" (click)="changeFile(mySource.filename, message.line)"  [ngClass]="{ selected: selectedLine == message.line && source.filename == mySource.filename }">
                                            <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad">
                                                    {{message.line}}:{{message.col_begin}}
                                                </span>
                                                <span class="col-lg-11 col-md-11 col-sm-11 col-xs-11 no-pad">{{message.name}}</span>
                                            </span>
                                        </span>
                                    </span>
                                </span>
                            </span>
                        </span>
                    </span>
                    <span class="info-span col-lg-12 col-md-12 col-sm-12 col-xs-12" *ngIf="reportService.message._ui_total_message_count == 0"> There are no message corresponding to the selected filters</span>
                </table>

                <table *ngIf="tabOpen == 'review'" class="file-line-container col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                    <span class="all-sources-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">

                        <span *ngFor="let mySource of reportService.message.sources"
                              class=" col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                              [ngClass]="mySource.filename === source.filename ? '' : 'hideIt'">
                            <span id="{{mySource.filename}}" class="all-messages-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad open" *ngIf="(mySource._total_message_count > 0 || !mySource._total_message_count)" >
                                <span *ngFor="let message of mySource.messages"
                                      class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                                      [ngClass]="(this.reportService.hideFiles && (message._ui_total_message_count == 0 || ( message._ui_total_message_count == null && message._total_message_count == 0)) || message.hide == false) ? 'hideIt' : ''">

                                    <span class="message-line col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 ">
                                            {{message.line}}:{{message.col_begin}}
                                        </span>
                                        <span class="col-lg-11 col-md-11 col-sm-11 col-xs-11 ">{{message.name}}</span>
                                    </span>
                                    <span *ngFor="let user_review of message.user_review">
                                        <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                            <!--<span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad"></span>-->
                                            <span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 no-pad">
                                                {{user_review.date | date : 'dd-MM-yyyy HH:mm'}}
                                            </span>
                                            <span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad">
                                                {{user_review.author}}
                                            </span>
                                            <span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 no-pad">
                                                {{user_review.status.toUpperCase()}}
                                            </span>
                                            <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-pad">
                                                {{user_review.message}}
                                            </span>
                                        </span>
                                    </span>
                                </span>
                            </span>
                            <span class="info-span col-lg-12 col-md-12 col-sm-12 col-xs-12" *ngIf="mySource.filename === source.filename && mySource._ui_total_message_count === 0"> There are no message corresponding to the selected filters </span>
                        </span>
                    </span>
                </table>

            </div>
        </div>
    </footer>
</div>
