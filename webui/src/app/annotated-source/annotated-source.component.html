<div class="layout-page col-lg-9 col-md-9 col-sm-8 col-xs-8 no-pad">
    <!-- Annotated source -->
    <div class="annotated-source-body col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
        <nav class="file-header col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
            <span>{{ source.project }}</span>
            <span  class="path-divider">/</span>
            <strong>{{ source.filename }}</strong>
        </nav>
        <main #scrollView class="scrollable-content col-lg-12 col-md-12 col-sm-12 col-xs-12" [ngClass]="showMessageList ? 'expanded' : 'reduce'">
            <div class="missing-file-content" *ngIf="!source.lines">
                <h4>Missing file content</h4>
                <p>
                    This is most likely due to an error during the HTML report
                    generation.
                </p>
            </div>
            <div class="file" *ngIf="source.lines">
                <annotated-source-content
                                          [lines]="source.lines"
                                          [tools]="source.tools"
                                          [coverage]="source.coverage"
                                          [inlineAnnotations]="inlineAnnotations"
                                          [displayMessages]="displayMessages">
                </annotated-source-content>
            </div>
        </main>
    </div>
    <footer class="layout-page-footer location-view col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" *ngIf="displayMessages">
        <div class="location-view-flex col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
            <div class="location-view-header col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                <span class="location-view-title" (click)="tabOpen = 'metric'" [ngClass]="tabOpen == 'metric' ? 'selected': ''" *ngIf="source.metrics">
                    File Metrics
                </span>
                <span class="location-view-title" (click)="tabOpen = 'message'; thisFile = true" [ngClass]="tabOpen == 'message' ? 'selected': ''">
                    File messages
                </span>
                <span class="location-view-title" (click)="tabOpen = 'messages'; thisFile = false" [ngClass]="tabOpen == 'messages' ? 'selected': ''">
                    All messages
                </span>
                <button (click)="writeReview()" class="location-view-review-btn" [disabled]="!checked_msg || checked_msg.length == 0 || tabOpen != 'message'">
                    <span>Add review</span>
                </button>
                <button class="location-view-collapse-btn"
                        [mdTooltip]="showMessageList ? 'Hide' : 'Show'"
                        mdTooltipPosition="left"
                        (click)="showMessageList = !showMessageList">
                    <md-icon class="md-18" [ngClass]="{ expanded: showMessageList }">
                        keyboard_capslock
                    </md-icon>
                </button>
            </div>
            <div class="location-view-list col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" [ngClass]="showMessageList ? 'expanded' : 'reduce'">
                <table *ngIf="tabOpen == 'metric'" class="file-line-container col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <span *ngIf="source.metrics && source.metrics.length > 0">
                        <tbody *ngFor="let metric of source.metrics; let idx = index" [attr.data-index]="idx" class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" [ngClass]="idx % 2 == 0 ? 'metric1' : 'metric2'">
                            <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 ">{{metric.rule.name}}</span>
                            <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 ">{{metric.value}}</span>
                        </tbody>
                    </span>
                    <span class="info-span col-lg-12 col-md-12 col-sm-12 col-xs-12" *ngIf="source.metrics.length == 0">
                        No metrics for this file.
                    </span>
                </table>


                <table *ngIf="tabOpen == 'message'" class="file-line-container col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                    <span *ngIf="reportService.message" class="all-sources-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">

                        <span *ngFor="let mySource of reportService.message.sources"
                              class=" col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                              [ngClass]="mySource.filename === source.filename ? '' : 'hideIt'">
                            <span id="{{mySource.filename}}" class="all-messages-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad open" *ngIf="mySource && (mySource._total_message_count > 0 || !mySource._total_message_count)" >
                                <span *ngFor="let message of mySource.messages"
                                      class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                                      [ngClass]="(!this.reportService.showFiles && (message._ui_total_message_count == 0 || ( message._ui_total_message_count == null && message._total_message_count == 0)) || message.hide == false) || (!reportService.showReviews && !message.user_review) ? 'hideIt' : ''">
                                    <span class="message-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                                          [ngClass]="(selected_msg.indexOf(message.id) != -1 ? 'selected' : '') + ' ' + message.tool">
                                        <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" (click)="selectMessage(message, $event)">
                                            <span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad">
                                                {{message.line}}:{{message.col_begin}}
                                            </span>
                                            <span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad ellipsis">
                                                {{message.ranking.name}}
                                            </span>
                                            <span class="col-lg-9 col-md-9 col-sm-9 col-xs-9 no-pad" >
                                                {{message.name}}
                                            </span>
                                            <span class="col-lg-1 col-md-1 col-sm-1 col-xs-2 no-pad">

                                                <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-pad ellipsis">
                                                    {{message.user_review ? message.user_review.display_name : 'Uncategorized'}}
                                                </span>
                                                <span  class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-pad" *ngIf="message.review_history" >
                                                    <span [ngClass]="message.review_history.length == 0 ? 'inactive' : ''" class="history-span"
                                                          (click)="ShowReviewHistory(message)">
                                                        <md-icon>history</md-icon>
                                                    </span>
                                                </span>
                                            </span>
                                        </span>
                                    </span>
                                </span>
                            </span>
                            <span class="info-span col-lg-12 col-md-12 col-sm-12 col-xs-12" *ngIf="mySource.filename === source.filename && mySource._ui_total_message_count === 0"> There are no messages corresponding to the selected filters </span>
                        </span>
                    </span>
                </table>

                <table *ngIf="tabOpen == 'messages'" class="file-line-container col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                    <span class="all-sources-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                          *ngIf="reportService.message && reportService.message._ui_total_message_count > 0 || !reportService.message._ui_total_message_count">
                        <span *ngFor="let mySource of reportService.message.sources"
                              class=" col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                              [ngClass]="(!this.reportService.showFiles && (mySource._ui_total_message_count == 0 || ( mySource._ui_total_message_count == null && mySource._total_message_count == 0))) ? 'hideIt' : ''">
                            <span id="{{mySource.filename}}" class="source-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad open">
                                <span class="header-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad" (click)="openClose(mySource.filename)">
                                    <span class="col-lg-9 col-md-9 col-sm-9 col-xs-9">
                                        <span *ngIf="!(mySource._ui_total_message_count == 0 || ( mySource._ui_total_message_count == null && mySource._total_message_count == 0))">
                                            <md-icon  class="md-18 source-tree">chevron_right</md-icon>
                                        </span>
                                        <span class="project-name"> {{mySource.projectName}} </span>
                                        <span class="file-name">{{mySource.filename}}</span>
                                    </span>
                                    <span class="center col-lg-3 col-md-3 col-sm-3 col-xs-3">
                                        {{
                                        mySource._ui_total_message_count != null ?
                                        mySource._ui_total_message_count :
                                        mySource._total_message_count
                                        }}
                                    </span>
                                </span>

                                <span class="all-messages-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                                      *ngIf="mySource">
                                    <span *ngFor="let message of mySource.messages"
                                          class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"
                                          [ngClass]="(!this.reportService.showFiles && (message._ui_total_message_count == 0 || ( message._ui_total_message_count == null && message._total_message_count == 0)) || message.hide == false) ? 'hideIt' : ''">
                                        <span class="message-line col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad"   [ngClass]="((selectedLine == message.line && source.filename == mySource.filename) ? 'selected': '') + ' ' + message.tool"
                                              [routerLink]="['/source', mySource.filename, { line: message.line, id: message.id }]">
                                            <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pad">
                                                <span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad">
                                                    {{message.line}}:{{message.col_begin}}
                                                </span>
                                                <span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 no-pad ellipsis">
                                                    {{message.ranking.name}}
                                                </span>
                                                <span class="col-lg-9 col-md-9 col-sm-9 col-xs-9 no-pad" >
                                                    {{message.name}}
                                                </span>
                                                <span class="col-lg-1 col-md-1 col-sm-1 col-xs-2 no-pad">
                                                    <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-pad ellipsis">
                                                        {{message.user_review ? message.user_review.display_name : 'Uncategorized'}}
                                                    </span>
                                                    <span  class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-pad" *ngIf="message.review_history" >
                                                        <span [ngClass]="message.review_history.length == 0 ? 'inactive' : ''" class="history-span"
                                                              (click)="ShowReviewHistory(message)">
                                                            <md-icon>history</md-icon>
                                                        </span>
                                                    </span>
                                                </span>
                                            </span>
                                        </span>
                                    </span>
                                </span>
                            </span>
                        </span>
                    </span>
                    <span class="info-span col-lg-12 col-md-12 col-sm-12 col-xs-12" *ngIf="reportService.message._ui_total_message_count == 0"> There are no messages corresponding to the selected filters</span>
                </table>
            </div>
        </div>
    </footer>
</div>
